language: php
php:
  - 5.3
  - 5.4
  - 5.5

before_install:
  - composer self-update
  - sudo apt-get update > /dev/null

install:
  # install php packages required for running a web server from drush on php 5.3
  - sudo apt-get install -y --force-yes php5-cgi php5-mysql
  - composer global require drush/drush:6.*
  - composer global require drupal/drupal-extension:3.0

  # add composer's global bin directory to the path
  # see: https://github.com/drush-ops/drush#install---composer
  - export PATH="$HOME/.composer/vendor/bin:$PATH"
  - phpenv rehash

before_script:

  # establish drupal and roomifycore
  - sudo mkdir -p /var/www
  - sudo chown travis:travis /var/www
  - drush dl drupal --destination=/var/www --default-major=7 --drupal-project-rename=drupal --y
  - cd /var/www/drupal/profiles
  - git clone https://github.com/Roomify/RoomifyCore.git roomifycore
  - cd roomifycore
  - drush make --contrib-destination --no-core roomifycore.make

  # get drush recipes setup functions
  - sudo chown -R travis:travis ~/.drush
  - cd ~/.drush/
  - git clone https://github.com/drupalprojects/drush_recipes.git
  - drush cc drush

script:
  # stand up drupal
  - cd /var/www/drupal
  - drush site-install -y --db-url=mysql://root@localhost/travisdb --db-su='root' --db-su-pw=''
  # just try out behat now
  - behat

after_script:
  - drush status

notifications:
  slack:
    rooms: roomify:HAsFaKg1eITiqpun9hKT9WJd#rooms-builds

